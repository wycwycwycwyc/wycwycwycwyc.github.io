<!doctype html><html lang=en><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>更改用户名</title><script src=script4.js></script><script src=script3.js></script><link rel=stylesheet href=styles3.css><script src=script5.js></script><link rel=stylesheet href=styles4.css><script src=script8.js></script><link rel=stylesheet href=styles5.css><link rel=stylesheet href=styles6.css><script src=script9.js></script><script src=script10.js></script><link href=https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js></script><style>body{font-family:Arial,sans-serif;margin:0;padding:20px;background-color:#f4f4f4}.container{width:400px;margin:50px auto;padding:30px;background-color:#fff;box-shadow:0 5px 20px #0003;border-radius:20px}h2{text-align:center}p{margin:10px 0}input[type=text]{width:96%;padding:15px;border:1px solid #ddd;border-radius:20px;font-size:16px}button{width:100%;padding:15px;border:none;border-radius:20px;background-color:#5cb85c;color:#fff;cursor:pointer;font-size:16px}.back-btn{display:inline-block;width:auto;padding:5px 10px;color:#5cb85c;text-decoration:none;font-size:16px;cursor:pointer;background-color:#f7f7f7;border:1px solid #ddd;border-radius:20px}.back-btn:hover{color:#4cae4c;background-color:#e7e7e7;border-color:#ccc}@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.container{opacity:1;transform:translateY(0%);animation:slideUp .8s ease-out forwards}body.dark-mode{background-color:#121212;color:#e0e0e0}body.dark-mode .container{background-color:#1e1e1e;box-shadow:0 5px 20px #ffffff0d;border:1px solid #333}body.dark-mode h2{color:#fff}body.dark-mode input[type=text]{background-color:#2d2d2d;border-color:#444;color:#fff}body.dark-mode input[type=text]:focus{border-color:#5cb85c;outline:none}body.dark-mode button{background-color:#5cb85c;color:#fff}body.dark-mode button:hover{background-color:#4cae4c}body.dark-mode .back-btn{background-color:#2d2d2d;border-color:#444;color:#5cb85c}body.dark-mode .back-btn:hover{background-color:#333;border-color:#555;color:#4cae4c}body.dark-mode ::placeholder{color:#888}</style><script>function updateUsername(){const oldUsername=localStorage.getItem('username');const newUsername=document.getElementById('newUsername').value;const isLoggedIn=localStorage.getItem("isLoggedIn")==='true';const message=document.getElementById('message');const usernameRegex=/^[\u4E00-\u9FA5A-Za-z0-9]+$/;if(newUsername.length>10){swal('用户名长度不能超过10个字符！','','error');return;}
if(!usernameRegex.test(newUsername)){swal('用户名只能包含汉字、英文和数字！','','error');return;}
message.textContent='正在更改用户名...';message.style.display='block';if(!isLoggedIn){swal('你还没登录!','登录后可更改','error');window.location.href='Login.html';return;}
fetch('https://jbcfz.serveo.net/update-username',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({oldUsername,newUsername})}).then(response=>{if(response.ok){localStorage.setItem('username',newUsername);message.textContent='用户名更新成功！';swal('用户名更新成功！','下次使用新用户名登录','success');window.location.href='index.html';}else{message.textContent="用户名更换失败，请换一个用户名，或稍后再试";swal('用户名更换失败，请换一个用户名，或稍后再试','用户名更换失败，请换一个用户名，或稍后再试','error');message.style.display='none';}}).catch(error=>{console.error('Error:',error);message.textContent='请求失败，请稍后重试。';swal('请求失败，请稍后重试。','请求失败，请稍后重试。','error');message.style.display='none';});}
function goBackOrHome(){window.history.length>1?window.history.back():window.location.href='index.html';}</script><div class=container><button class=back-btn onclick=goBackOrHome()>返回</button><h2>更改用户名</h2><p>当前用户名: <span id=currentUsername></span><form id=usernameForm onsubmit=event.preventDefault();updateUsername();><input id=newUsername placeholder=输入新用户名 required maxlength=10><br><br><button>更改用户名</button></form><p id=message style=display:none></div><script>isLoggedIn=localStorage.getItem('isLoggedIn')==='true';if(!isLoggedIn){document.getElementById('currentUsername').textContent='未登录';}else{document.getElementById('currentUsername').textContent='正在加载'
let userId=localStorage.getItem('userid');fetch('https://jbcfz.serveo.net/get-username-by-id',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({id:userId})}).then(response=>{if(!response.ok){throw new Error('Network response was not ok');}
return response.json();}).then(data=>{if(data.success){console.log('用户名:',data.data.username);localStorage.setItem('username',data.data.username);document.getElementById('currentUsername').textContent=localStorage.getItem('username')||'未登录';}else{console.error(data.message);}}).catch(error=>{console.error('Fetch error:',error);});}</script>