<!doctype html><html lang=zh-CN><meta charset=utf-8><title>图片上传表单</title><script src=script4.js></script>
<script src=script3.js></script>
<link rel=stylesheet href=styles3.css><script src=script5.js></script>
<link rel=stylesheet href=styles4.css><script src=script8.js></script>
<link rel=stylesheet href=styles5.css><link rel=stylesheet href=styles6.css><script src=script9.js></script>
<script src=script10.js></script>
<script src=https://hcaptcha.com/1/api.js async defer></script>
<link href=https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css rel=stylesheet><script src=https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js></script>
<link href=message.min.css rel=stylesheet><script src=message.min.js></script><style>body{font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}.form-container{width:400px;margin:50px auto;padding:30px;background-color:#fff;box-shadow:0 5px 20px rgba(0,0,0,.2);border-radius:20px;text-align:center}input[type=file]{display:none}img.upload-preview{display:inline-block;max-width:40%;height:auto;margin-top:10px;border:1px solid #ddd;padding:5px;background-color:#fff}.upload-preview{display:inline-block;margin-right:10px}button{width:100%;padding:15px;border:none;border-radius:20px;background-color:#5cb85c;color:#fff;cursor:pointer;font-size:16px}progress{width:100%;margin-top:5px}.progress-info{font-size:.8em}@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.form-container{opacity:1;transform:translateY(0%);animation:slideUp .8s ease-out forwards}#crop-area{position:relative;width:400px;height:400px;overflow:hidden;border:1px solid #000;margin-top:20px}#crop-area img{position:absolute;max-width:100%;max-height:100%;margin:auto;top:0;left:0;right:0;bottom:0}#crop-circle{position:absolute;cursor:move;border:1px solid #fff;border-radius:50%}</style><div class=form-container><form id=uploadForm><h1>上传头像</h1><button type=button class=btn onclick='document.getElementById("avatar").click()'>选择图片</button>
<input type=file id=avatar accept=image/png,image/jpeg required onchange=previewImage(this)><br><img id=previewold class=upload-preview src=# alt=图片预览>
<img id=preview class=upload-preview src=#>
<progress id=uploadProgress value=0 max=100>0%</progress><div class=progress-info id=progressInfo></div><button type=button onclick=uploadImage()>开始上传</button></form></div><script>const imageUrl=`https://jbcfz.serveo.net/get-icon-by-id?id=${localStorage.getItem("userid")}`;document.getElementById("previewold").src=imageUrl;function previewImage(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){var e,n,o,s=document.createElement("canvas"),a=s.getContext("2d"),i=t.width/t.height;i>1?(e=200,n=200):i<1?(n=200,e=200):(e=200,n=200),s.width=200,s.height=200,a.drawImage(t,(200-e)/2,(200-n)/2,e,n),o=document.getElementById("preview"),o.src=s.toDataURL("image/png"),o.style.display="inline"},t.src=e.target.result},t.readAsDataURL(e.files[0])}}function uploadImage(){var s=localStorage.getItem("userid"),e=document.getElementById("preview"),t=document.getElementById("uploadProgress"),n=document.getElementById("progressInfo");if(!e.src){Qmsg.error("请先选择文件");return}fetch(e.src).then(e=>e.blob()).then(e=>{if(!["image/jpeg","image/png"].includes(e.type)){Qmsg.error("只能上传不超过1MB的图片,格式为png或jpg");return}var o,i=new FormData;i.append("userId",s),i.append("avatar",e),o=new XMLHttpRequest,o.open("POST","https://jbcfz.serveo.net/upload-image",!0),o.upload.onprogress=function(e){if(e.lengthComputable){var s=Math.round(e.loaded/e.total*100);t.value=s,n.textContent="上传进度: "+s+"%"}},o.onload=function(){o.status===200?(swal("图片上传成功","你的账号头像已更新","success"),location.href="settings.html"):swal("图片上传失败: ",o.statusText,"error"),t.value=0,n.textContent=""},o.send(i)}).catch(e=>{console.error("Error converting image to blob",e),Qmsg.error("无法转换图片")})}</script>