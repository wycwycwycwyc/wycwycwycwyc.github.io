<!doctype html><html lang=zh-cn><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>登录页面</title><script src=script4.js></script><script src=script3.js></script><link rel=stylesheet href=styles3.css><script src=script5.js></script><link rel=stylesheet href=styles4.css><script src=script8.js></script><link rel=stylesheet href=styles5.css><link rel=stylesheet href=styles6.css><script src=script9.js></script><script src=script10.js></script><script src=https://hcaptcha.com/1/api.js async defer></script><link href=https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.css rel=stylesheet><script src=https://cdn.bootcss.com/sweetalert/1.1.3/sweetalert.min.js></script><style>body{font-family:Arial,sans-serif;background-color:#f7f7f7;margin:0;padding:0;overflow:hidden}.login-container{width:400px;margin:50px auto;padding:30px;background-color:#fff;box-shadow:0 5px 20px #0003;border-radius:20px}.login-container h2{text-align:center;color:#333;font-size:24px}.form-group{margin-bottom:20px}.form-group label{display:block;color:#666;font-size:18px}.form-group input{width:96%;padding:15px;border:1px solid #ddd;border-radius:20px;font-size:16px}.form-group button{width:100%;padding:15px;border:none;border-radius:20px;background-color:#5cb85c;color:#fff;cursor:pointer;font-size:16px}.form-group button:hover{background-color:#4cae4c}.error{color:red;margin-top:10px;display:none}.back-btn{display:inline-block;padding:5px 10px;color:#5cb85c;text-decoration:none;font-size:16px;cursor:pointer;background-color:#f7f7f7;border:1px solid #ddd;border-radius:20px}.back-btn:hover{color:#4cae4c;background-color:#e7e7e7;border-color:#ccc}body.dark-mode{background-color:#1a1a1a;color:#fff}body.dark-mode .login-container{background-color:#272727;box-shadow:0 5px 20px #ffffff1a}body.dark-mode .login-container h2,body.dark-mode .form-group label{color:#fff}.dark-mode .form-group input{background-color:#333;border-color:#444;color:#fff}body.dark-mode .form-group button{background-color:#4caf50;color:#fff}body.dark-mode .form-group button:hover{background-color:#45a049}body.dark-mode .error{color:#f55}.back-btn{display:inline-block;padding:5px 10px;color:#5cb85c;text-decoration:none;font-size:16px;cursor:pointer;background-color:#f7f7f7;border:1px solid #ddd;border-radius:20px}.back-btn:hover{color:#4cae4c;background-color:#e7e7e7;border-color:#ccc}body.dark-mode .back-btn{color:#4caf50;background-color:#333;border-color:#555}body.dark-mode .back-btn:hover{color:#45a049;background-color:#303030;border-color:#3c3c3c}@keyframes slideUp{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}.login-container{opacity:1;transform:translateY(0%);animation:slideUp .8s ease-out forwards}.verifying{color:#666;margin-top:10px;display:none}</style><div class=login-container><button class=back-btn onclick=goBackOrHome()>返回</button><h2>登录</h2><form id=loginForm><div class=form-group><label for=username>用户名/邮箱</label>
<input id=username name=username required></div><div class=form-group><label for=password>密码</label>
<input type=password id=password name=password required></div><div class=h-captcha data-sitekey=646c3294-ce44-4d5a-a04a-e1603366ea8c></div><div class=form-group><button>登录</button></div><div class=error id=error></div><div class=verifying id=verifying>正在验证...</div><div class=form-group><p>还没有账户？<a href=Register.html>注册一个</a>!，或者<a href=forgotPassword.html>忘记密码</a>？</div></form></div><script>function isStrictEmail(input){const strictEmailRegex=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return(typeof input==="string"&&strictEmailRegex.test(input)&&input.length<=254&&input.split("@")[0].length<=64);}
document.getElementById('loginForm').addEventListener('submit',function(event){event.preventDefault();var username=document.getElementById('username').value;var password=document.getElementById('password').value;var errorElement=document.getElementById('error');var verifyingElement=document.getElementById('verifying');var captchaResponse=hcaptcha.getResponse();if(!captchaResponse){errorElement.textContent='请完成人机验证';errorElement.style.display='block';return;}
verifyingElement.style.display='block';var xhr=new XMLHttpRequest();xhr.open('POST','https://jbcfz.serveo.net/login',true);xhr.setRequestHeader('Content-Type','application/json');xhr.onreadystatechange=function(){if(xhr.readyState===4){verifyingElement.textContent='正在更新你的用户信息...'
if(xhr.status===200){errorElement.textContent='';errorElement.style.display='none';swal("登录成功！","你将解锁更多新功能","success");if(!isStrictEmail(username)){fetch('https://jbcfz.serveo.net/get-user-id-by-username',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:username})}).then(response=>{if(!response.ok){throw new Error('Network response was not ok');}
return response.json();}).then(data=>{if(data.success){const userId=data.data.userId;console.log('用户ID:',userId);var receivedUserId=userId;localStorage.setItem('username',username);localStorage.setItem('isLoggedIn','true');localStorage.setItem('userid',userId);swal("处理信息完成","跳转到主页");window.location.href='index.html';}else{console.log(data.message);}}).catch(error=>{console.error('Fetch error:',error);});}else{fetch('https://jbcfz.serveo.net/get-user-id-or-username-by-email',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email:username})}).then(response=>{if(!response.ok){throw new Error('Network response was not ok');}
return response.json();}).then(data=>{if(data.success){const userId=data.data.userId;console.log('用户ID:',userId);var receivedUserId=userId;username=data.data.username;localStorage.setItem('username',username);localStorage.setItem('isLoggedIn','true');localStorage.setItem('userid',userId);swal("处理信息完成","跳转到主页");window.location.href='index.html';}else{console.log(data.message);}}).catch(error=>{console.error('Fetch error:',error);});}}else{var errorMessage='登录失败';switch(xhr.status){case 401:errorMessage='用户名/邮箱或密码错误';break;case 400:errorMessage='用户名/邮箱或密码不能为空';break;default:errorMessage='未知错误';break;}
errorElement.textContent=errorMessage;errorElement.style.display='block';swal("登录失败",errorMessage,"error");}}};xhr.send(JSON.stringify({username:username,password:password,h_captcha:captchaResponse}));});</script>