document.addEventListener('DOMContentLoaded',function(){function checkLoginStatus(){var isLoggedIn=localStorage.getItem('isLoggedIn')==='true';return isLoggedIn;}
function getUrlParameter(name){name=name.replace(/[\[\]]/g,'\\$&');var regex=new RegExp('[?&]'+name+'(=([^&#]*)|&|#|$)');var results=regex.exec(window.location.href);if(!results)return null;if(!results[2])return '';return decodeURIComponent(results[2].replace(/\+/g,' '));}
function getCurrentPageFileName(){var path=window.location.pathname;var page=path.split("/").pop();return page||'index.html';}
function autoDownload(){if(checkLoginStatus()){var code=document.getElementById("sourceCode").innerText;var blob=new Blob([code],{type:"text/plain;charset=utf-8"});var filename=document.title+".txt";Qmsg.success("已开始下载");saveAs(blob,filename);}}
var autoDownloadParam=getUrlParameter('autoDownload');if(autoDownloadParam&&autoDownloadParam.toLowerCase()==='true'){autoDownload();}
document.getElementById('downloadSourceCodeBtn').addEventListener('click',function(){if(checkLoginStatus()){var code=document.getElementById("sourceCode").innerText;var blob=new Blob([code],{type:"text/plain;charset=utf-8"});var filename=document.title+".txt";Qmsg.success("已开始下载");saveAs(blob,filename);}else{var currentPage=getCurrentPageFileName();var redirectUrl=encodeURIComponent(currentPage+'?autoDownload=true');window.location.href='Login.html?redirect='+redirectUrl;}});});